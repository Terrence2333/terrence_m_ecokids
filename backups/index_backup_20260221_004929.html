{% extends "base.html" %}
{% block content %}
<canvas id="noise-canvas" style="position: fixed; inset: 0; z-index: 20000; pointer-events: none; opacity: 0; transition: opacity 0.1s;"></canvas>
<div id="boot-screen" style="position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: 'Orbitron', sans-serif; color: #d4af37;">
    <div id="loader-ring" style="width: 120px; height: 120px; border: 2px solid #ff4500; border-radius: 50%; animation: spin 0.5s linear infinite;"></div>
    <p style="letter-spacing: 10px; margin-top: 20px; font-size: 0.7rem;">ESTABLECIENDO ENLACE CON RENDER...</p>
</div>
<div id="main-interface" style="padding: 50px; opacity: 0; visibility: hidden; transition: opacity 1s;">
    <h1 style="color: #d4af37; font-family: 'Orbitron'; font-weight: 900;">TERRENCE M - LIVE SYSTEM</h1>
    <div style="background: rgba(255,69,0,0.1); border: 1px solid #ff4500; padding: 25px; color: #fff; font-family: monospace;">
        <p>[ SISTEMA OPERATIVO EN LÍNEA ]</p>
        <p>> PROTOCOLO DE PÁNICO: [ESC] ACTIVO</p>
        <p>> RADAR SÍSMICO: CALIBRADO</p>
    </div>
</div>
<script>
    window.addEventListener('keydown', (e) => { 
        if (e.key === "Escape") {
            document.getElementById('noise-canvas').style.opacity = "1";
            setTimeout(() => { location.reload(); }, 500);
        }
    });
    window.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            document.getElementById('boot-screen').style.display = 'none';
            document.getElementById('main-interface').style.visibility = 'visible';
            document.getElementById('main-interface').style.opacity = '1';
        }, 1500);
    });
</script>
{% endblock %}
{% extends "base.html" %}
{% block content %}
<style>
    /* 1. MANTENER TU ESTÉTICA BASE (CAPA UI) */
    :root {
        --gold-tm: #d4af37;
        --orange-tm: #ff4500;
        --blue-tm: #0055ff;
    }

    body, html {
        background: #000 !important;
        margin: 0; padding: 0;
        overflow: hidden;
        width: 100%; height: 100%;
        font-family: 'Orbitron', sans-serif;
    }

    /* CAPA FONDO (Z-INDEX 1) - TU RADAR */
    #background-system {
        position: fixed;
        inset: 0;
        z-index: 1;
        pointer-events: none;
    }

    /* CAPA TUYA (Z-INDEX 10) - NO SE TOCA */
    #main-interface {
        position: relative;
        z-index: 10;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* CAPA CHATBOY IA (Z-INDEX 100) */
    #chat-dock {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 380px;
        background: rgba(0,0,0,0.95);
        border: 1px solid var(--orange-tm);
        z-index: 100;
        box-shadow: 0 0 20px #000;
    }

    /* ESTILOS DE TU IMAGEN BASE */
    nav.top-nav {
        height: 80px;
        border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        display: flex;
        justify-content: space-around;
        align-items: center;
        color: var(--gold-tm);
        letter-spacing: 10px;
    }

    .hero-section {
        flex: 1;
        padding: 60px 8%;
        display: grid;
        grid-template-columns: 1.2fr 1fr;
    }

    .identity-name { font-size: 5rem; font-weight: 900; letter-spacing: 15px; color: #fff; margin: 0; }
    
    .camera-frame {
        border: 1px solid var(--gold-tm);
        padding: 20px;
        background: rgba(0,0,0,0.8);
    }

    .video-circle {
        width: 180px; height: 180px;
        border-radius: 50%;
        border: 4px solid #0f0;
        overflow: hidden;
    }

    /* ANIMACIÓN CARGA ESCUDO */
    #charge-fill {
        position: absolute; inset: -5px;
        border: 4px solid var(--blue-tm);
        border-radius: 15px;
        clip-path: inset(100% 0 0 0);
        transition: clip-path 0.1s;
    }
</style>

<div id="background-system">
    <div style="position: absolute; width: 100%; height: 2px; background: var(--orange-tm); top: 0; box-shadow: 0 0 15px var(--orange-tm); animation: scan 8s linear infinite;"></div>
    <canvas id="radar-canvas"></canvas>
</div>

<div id="main-interface">
    <nav class="top-nav">
        <span>HOME</span><span>UNIDADES</span><span>NODOS</span><span>IMPERIO</span><span>PAGOS</span>
    </nav>

    <main class="hero-section">
        <div>
            <h1 class="identity-name">TERRENCE M</h1>
            <div style="color: var(--gold-tm); margin-top: 30px; font-family: monospace; line-height: 2;">
                <p>> KERNEL: 0x8899-OMNI-V3</p>
                <p>> STATUS: <span style="color: #0f0;">STABLE</span></p>
                <p>> COORD: <span id="lat">4911</span> / <span id="lon">1552</span></p>
                <p>> UPTIME: <span id="uptime">0s</span></p>
            </div>
            <div style="display: flex; gap: 40px; margin-top: 40px;">
                <div style="text-align: center;"><div style="font-size: 2.5rem; color: var(--gold-tm); font-weight: 900;">4500+</div><div style="font-size: 0.6rem; color: #666;">CO2 REDUCIDO</div></div>
                <div style="text-align: center;"><div style="font-size: 2.5rem; color: var(--gold-tm); font-weight: 900;">1250+</div><div style="font-size: 0.6rem; color: #666;">MW GENERADOS</div></div>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; align-items: flex-end;">
            <div class="camera-frame">
                <div class="video-circle">
                    <video id="webcam" autoplay playsinline muted style="width:100%; height:100%; object-fit:cover;"></video>
                </div>
                <p style="text-align: center; color: #0f0; font-size: 0.7rem; margin-top: 15px; font-weight: 900;">DIRECTOR_TERRENCE_M</p>
            </div>
        </div>
    </main>

    <div style="padding: 0 8% 40px;">
        <div style="border: 2px solid var(--gold-tm); padding: 15px 40px; display: inline-block; background: rgba(0,0,0,0.6);">
            <h2 id="shield-status" style="margin: 0; letter-spacing: 15px; color: #fff;">SHIELD: STANDBY</h2>
        </div>
    </div>
</div>

<div id="chat-dock">
    <div style="background: var(--orange-tm); color: #000; padding: 8px; font-weight: 900; font-size: 0.7rem;">TERRENCE_IA_PROCESOR</div>
    <div id="chat-content" style="height: 140px; overflow-y: auto; padding: 12px; font-family: monospace; font-size: 0.75rem; color: #fff;"></div>
    <canvas id="seismo" style="width: 100%; height: 30px; background: #000; border-top: 1px solid #222;"></canvas>
    <div style="display: flex; border-top: 1px solid var(--orange-tm);">
        <input type="text" id="chat-input" placeholder="ORDEN..." style="flex:1; background:#000; border:none; color:#fff; padding:12px; outline:none; font-family: monospace;">
        <button onclick="talkToIA()" style="background: var(--orange-tm); border:none; padding: 0 15px; cursor: pointer; font-weight: 900;">EXE</button>
    </div>
</div>

<div id="btn-shield" style="position: fixed; bottom: 35px; left: 40px; width: 70px; height: 70px; background: #b59431; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 110;">
    <div id="charge-fill"></div>
    <svg width="35" height="35" viewBox="0 0 24 24" fill="#fff"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
</div>

<script>
    // 1. CÁMARA
    navigator.mediaDevices.getUserMedia({video:true}).then(s => document.getElementById('webcam').srcObject = s);

    // 2. RADAR GLOBO (FONDO)
    const rc = document.getElementById('radar-canvas'), r = rc.getContext('2d');
    rc.width = window.innerWidth; rc.height = window.innerHeight;
    let rRot = 0;
    function drawR() {
        r.fillStyle = "black"; r.fillRect(0,0,rc.width, rc.height);
        r.strokeStyle = "rgba(212, 175, 55, 0.15)";
        for(let i=0; i<18; i++) {
            r.beginPath();
            r.ellipse(rc.width/2, rc.height/2, Math.abs(280 * Math.sin(rRot+i)), 280, 0, 0, Math.PI*2);
            r.stroke();
        }
        rRot += 0.002; requestAnimationFrame(drawR);
    }
    drawR();

    // 3. CHATBOY IA
    const chat = document.getElementById('chat-content');
    function talkToIA() {
        const inp = document.getElementById('chat-input');
        if(!inp.value) return;
        chat.innerHTML += `<div style="color:#888">> ${inp.value}</div>`;
        const v = inp.value.toLowerCase();
        setTimeout(() => {
            let res = "COMANDO PROCESADO.";
            if(v.includes("hola")) res = "SISTEMAS TERRENCE.M OPERATIVOS, DIRECTOR.";
            if(v.includes("status")) res = "KERNEL ESTABLE. ENERGÍA 100%.";
            chat.innerHTML += `<div style="color:var(--orange-tm)">[IA]: ${res}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }, 500);
        inp.value = "";
    }

    // 4. CARGA ESCUDO
    let hold = false, c = 0;
    const b = document.getElementById('btn-shield'), fill = document.getElementById('charge-fill');
    b.onmousedown = () => hold = true;
    window.onmouseup = () => { hold = false; c = 0; fill.style.clipPath = `inset(100% 0 0 0)`; };
    setInterval(() => {
        if(hold && c < 100) {
            c += 2; fill.style.clipPath = `inset(${100-c}% 0 0 0)`;
            if(c >= 100) document.getElementById('shield-status').innerText = "SHIELD: ACTIVE";
        }
    }, 50);

    // 5. DINÁMICAS
    let up = 0;
    setInterval(() => {
        up++; document.getElementById('uptime').innerText = up + "s";
        document.getElementById('lat').innerText = Math.floor(Math.random()*8999)+1000;
        document.getElementById('lon').innerText = Math.floor(Math.random()*8999)+1000;
    }, 1000);

    // 6. SISMÓGRAFO
    const sc = document.getElementById('seismo').getContext('2d');
    let sx = 0;
    function drawS() {
        sc.fillStyle = "rgba(0,0,0,0.1)"; sc.fillRect(0,0,400,30);
        sc.strokeStyle = "var(--orange-tm)"; sc.beginPath(); sc.moveTo(sx, 15);
        sc.lineTo(sx+2, 15+(Math.random()*12-6)); sc.stroke(); sx = (sx+2)%400;
        requestAnimationFrame(drawS);
    }
    drawS();

    @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
</script>
{% endblock %}