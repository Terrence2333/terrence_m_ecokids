{% extends "base.html" %}
{% block content %}
<div id="boot-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: 'Orbitron', sans-serif; color: var(--gold);">
    <div style="width: 70px; height: 70px; border: 2px solid #111; border-top: 2px solid var(--gold); border-left: 2px solid var(--gold); border-radius: 50%; animation: spin 0.5s linear infinite;"></div>
    <div id="boot-log" style="width: 500px; height: 250px; font-size: 0.6rem; color: var(--neon); overflow: hidden; margin-top: 20px; border: 1px solid rgba(212,175,55,0.3); padding: 15px; background: rgba(2,2,2,0.9); font-family: monospace;"></div>
    <p style="font-size: 0.5rem; letter-spacing: 10px; margin-top: 20px; color: var(--gold);">STATE DEFENSE SYSTEM: ACTIVE</p>
</div>

<div id="defense-alert" style="position: fixed; inset: 0; background: rgba(255,0,0,0.1); z-index: 9999; display: none; pointer-events: none; border: 10px solid red; animation: pulseRed 0.5s infinite;"></div>

<div id="master-bg" style="position: fixed; inset: 0; z-index: -1; background: #000; overflow: hidden;">
    <canvas id="neural-canvas" style="position: absolute; inset: 0;"></canvas>
    <div id="radar-circle" style="position: absolute; top: 50%; left: 50%; width: 800px; height: 800px; border: 1px solid rgba(212,175,55,0.1); border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none;"></div>
</div>

<div id="main-interface" style="display: flex; justify-content: space-between; padding: 40px 5%; align-items: flex-start; height: 85vh; position: relative; z-index: 1; opacity: 0; transition: opacity 2s;">
    
    <div style="width: 300px;">
        <div style="position: relative; width: 240px; height: 240px; border: 3px solid var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); box-shadow: 0 0 60px rgba(212,175,55,0.2);">
            <div style="position: absolute; width: 108%; height: 108%; border: 1px dashed var(--gold); border-radius: 50%; animation: spin 30s linear infinite;"></div>
            <h1 style="font-size: 2.2rem; font-weight: 900; text-shadow: 0 0 30px var(--gold);">TERRENCE M</h1>
        </div>
        <div style="margin-top: 30px; background: rgba(5,5,5,0.95); border: 1px solid var(--gold); border-left: 8px solid var(--gold); padding: 20px; font-size: 0.7rem;">
            <p style="color:var(--gold); font-weight: 900;">[ NUCLEAR_AUTH_CODE: ENABLED ]</p>
            <p style="color:var(--neon); margin: 8px 0;">> DEFCON LEVEL: 1</p>
            <p style="color:#fff; margin: 8px 0;">> ENCRYPTION: OMEGA-NONCE</p>
            <div id="threat-monitor" style="color:red; font-size: 0.6rem; margin-top: 15px; font-weight: bold; border-top: 1px solid #333; padding-top: 10px;">SCANNING FOR INTRUSIONS...</div>
        </div>
    </div>

    <div style="display: flex; gap: 30px; align-self: center;">
        <div class="stat-hex">
            <span style="font-size: 3rem; color: var(--gold); font-weight: 900;">4500+</span><br>
            <small>REDUCTION_CO2</small>
        </div>
        <div class="stat-hex">
            <span style="font-size: 3rem; color: var(--gold); font-weight: 900;">1250+</span><br>
            <small>MEGAWATTS_GEN</small>
        </div>
    </div>

    <div style="text-align: right; width: 300px;">
        <div style="border: 2px solid var(--gold); padding: 10px; background: #000; box-shadow: 0 0 50px #000;">
            <div style="width: 100%; height: 200px; border: 2px solid var(--neon); position: relative; overflow: hidden;">
                <video id="webcam" autoplay playsinline muted style="width: 100%; height: 100%; object-fit: cover; filter: brightness(1.2) sepia(1);"></video>
                <div style="position: absolute; top:0; width:100%; height:2px; background:var(--neon); animation: scanLine 2s infinite linear;"></div>
            </div>
            <p style="color:var(--neon); font-size: 0.6rem; font-weight: 900; margin-top: 10px; letter-spacing: 2px;">SECURE_SCAN: DIRECTOR_AUTH</p>
        </div>
        <div id="mic-btn" style="margin-top: 20px; background: var(--gold); padding: 20px; border-radius: 5px; cursor: pointer; display: inline-block;" onclick="startListening()">
            <svg viewBox="0 0 24 24" width="30" fill="#000"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
        </div>
    </div>
</div>

<div id="chat-container" style="position: fixed; bottom: 80px; right: 30px; width: 380px; background: rgba(2,2,2,0.98); border: 2px solid var(--gold); z-index: 1000;">
    <div style="background: var(--gold); color: #000; padding: 12px; font-weight: 900; font-size: 0.75rem; display: flex; justify-content: space-between;">
        <span>STATE_DEFENSE_CORE_V.7</span>
        <span id="system-clock">00:00:00</span>
    </div>
    <div id="chat-box" style="height: 220px; overflow-y: auto; padding: 15px; font-size: 0.7rem; color: #fff; font-family: monospace;"></div>
    <div style="display: flex; border-top: 2px solid var(--gold);">
        <input type="text" id="user-input" placeholder="ORDEN TACTICA..." style="flex:1; background:#000; border:none; color:#fff; padding:15px; font-family:'Orbitron'; font-size:0.7rem; outline:none;">
        <button onclick="sendMessage()" style="background:var(--gold); border:none; padding:15px; cursor:pointer; font-weight:900;">RUN</button>
    </div>
</div>

<style>
    :root { --gold: #d4af37; --neon: #00ff00; }
    .stat-hex { background: rgba(0,0,0,0.8); padding: 30px; border: 1px solid var(--gold); text-align: center; clip-path: polygon(10% 0%, 90% 0%, 100% 50%, 90% 100%, 10% 100%, 0% 50%); }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes scanLine { 0% { top: 0; } 100% { top: 100%; } }
    @keyframes pulseRed { 0% { opacity: 0.1; } 50% { opacity: 0.4; } 100% { opacity: 0.1; } }
    .glitch { animation: glitchAnim 0.1s infinite; }
    @keyframes glitchAnim { 0% { transform: translate(0); } 50% { transform: translate(-5px, 5px); } 100% { transform: translate(5px, -5px); } }
</style>

<script>
    // 1. PROTOCOLOS DE DEFENSA (CONTRA HACKERS)
    document.addEventListener('contextmenu', e => { e.preventDefault(); defenseTrigger("CLICK DERECHO DETECTADO"); });
    document.onkeydown = e => { if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) { e.preventDefault(); defenseTrigger("INTENTO DE INSPECCIÓN DE CÓDIGO"); return false; } };

    function defenseTrigger(type) {
        document.getElementById('defense-alert').style.display = 'block';
        speak("¡Alerta! Intento de intrusión detectado. Protocolo Aegis activado.");
        setTimeout(() => document.getElementById('defense-alert').style.display = 'none', 2000);
        const b = document.getElementById('chat-box');
        b.innerHTML += `<p style="color:red">[!!!] INTRUSIÓN: ${type}</p>`;
        b.scrollTop = b.scrollHeight;
    }

    // 2. SECUENCIA DE ARRANQUE MILITAR
    const logArr = [
        "ACCEDIENDO A RED DEFENSA NACIONAL...",
        "ACTIVANDO FIREWALL PERIMETRAL...",
        "ENLACE SATELITAL ENCRIPTADO...",
        "NIVEL DE AMENAZA: DEFCON 1",
        "BIENVENIDO, DIRECTOR TERRENCE M."
    ];
    let lIdx = 0;
    function boot() {
        if(lIdx < logArr.length){
            document.getElementById('boot-log').innerHTML += `<p>> ${logArr[lIdx]}</p>`;
            lIdx++;
            document.getElementById('boot-progress').style.width = (lIdx * 20) + "%";
            setTimeout(boot, 800);
        } else {
            setTimeout(() => {
                document.getElementById('boot-screen').style.display = 'none';
                document.getElementById('main-interface').style.opacity = '1';
                speak("Sistema de defensa de estado activo. Director, el mundo está bajo su supervisión.");
            }, 1000);
        }
    }
    window.onload = boot;

    // 3. FONDO NEURAL REACTIVO
    const canvas = document.getElementById('neural-canvas');
    const ctx = canvas.getContext('2d');
    let pts = [];
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    for(let i=0; i<100; i++) pts.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: Math.random()-0.5, vy: Math.random()-0.5});
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "rgba(212,175,55,0.2)";
        pts.forEach(p => {
            p.x += p.vx; p.y += p.vy;
            if(p.x<0 || p.x>canvas.width) p.vx*=-1; if(p.y<0 || p.y>canvas.height) p.vy*=-1;
            pts.forEach(p2 => {
                if(Math.hypot(p.x-p2.x, p.y-p2.y)<100){ ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); }
            });
        });
        requestAnimationFrame(draw);
    }
    draw();

    // 4. IA Y CHISTES DE HACKERS
    const chistes = ["¿Por qué los hackers no van al campo? Porque hay muchos bugs.", "¿Cómo se despiden los informáticos? Con un control-zeta.", "Un programador se va a dormir y pone dos vasos en la mesilla: uno lleno por si tiene sed y otro vacío por si no la tiene."];
    function speak(t) { const m = new SpeechSynthesisUtterance(t); m.lang='es-ES'; m.rate=0.85; m.pitch=0.6; window.speechSynthesis.speak(m); }
    setInterval(() => {
        document.getElementById('system-clock').innerText = new Date().toLocaleTimeString();
        document.getElementById('threat-monitor').innerText = `GLOBAL_THREAT: ${Math.floor(Math.random()*10)}% | SENSORS: ACTIVE`;
    }, 1000);

    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = Recognition ? new Recognition() : null;
    if(rec){
        rec.lang = 'es-ES';
        function startListening() { rec.start(); speak("Escuchando órdenes de estado."); }
        rec.onresult = (e) => { document.getElementById('user-input').value = e.results[0][0].transcript; sendMessage(); };
    }

    function sendMessage() {
        const i = document.getElementById('user-input');
        const b = document.getElementById('chat-box');
        if(!i.value) return;
        b.innerHTML += `<p style="color:#666">> CMD: ${i.value}</p>`;
        const val = i.value.toLowerCase();
        let r = "Protocolo Terrence.m ejecutado con éxito.";
        if(val.includes("hola")) r = "Director, los sistemas de armas defensivas y satélites están sincronizados.";
        if(val.includes("chiste")) r = chistes[Math.floor(Math.random()*chistes.length)];
        if(val.includes("ataque")) { r = "Iniciando contramedidas electrónicas. Bloqueando acceso extranjero."; document.getElementById('main-interface').classList.add('glitch'); setTimeout(() => document.getElementById('main-interface').classList.remove('glitch'), 1000); }
        setTimeout(() => { b.innerHTML += `<p style="color:var(--gold)">[SYSTEM]: ${r}</p>`; b.scrollTop = b.scrollHeight; speak(r); }, 500);
        i.value = "";
    }
</script>
{% endblock %}