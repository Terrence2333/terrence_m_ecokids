{% extends "base.html" %}
{% block content %}
<div id="boot-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: 'Orbitron', sans-serif; color: var(--gold);">
    <div style="width: 50px; height: 50px; border: 5px solid #222; border-top: 5px solid var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;"></div>
    <div id="boot-log" style="width: 450px; height: 200px; font-size: 0.6rem; color: var(--neon); overflow: hidden; background: rgba(10,10,10,0.9); padding: 10px; border: 1px solid #333;"></div>
    <div style="width: 300px; height: 4px; background: #111; margin-top: 15px; border-radius: 10px; overflow: hidden;">
        <div id="boot-progress" style="width: 0%; height: 100%; background: var(--gold); transition: width 0.1s;"></div>
    </div>
    <p style="font-size: 0.5rem; letter-spacing: 5px; margin-top: 10px; color: var(--gold);">AUTHORIZING: DIRECTOR_TERRENCE_M</p>
</div>

<audio id="bg-music" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>

<div id="master-bg" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: #000; overflow: hidden;">
    <canvas id="neural-canvas" style="position: absolute; top:0; left:0; width:100%; height:100%;"></canvas>
    <div style="position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, transparent 20%, #000 90%);"></div>
</div>

<div id="main-interface" style="display: flex; justify-content: space-between; padding: 40px 5%; align-items: flex-start; height: 85vh; position: relative; z-index: 1; opacity: 0; transition: opacity 2s;">
    
    <div style="width: 250px;">
        <div style="position: relative; width: 220px; height: 220px; border: 2px solid var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); box-shadow: 0 0 40px rgba(212,175,55,0.2);">
            <div style="position: absolute; width: 110%; height: 110%; border: 1px dashed var(--gold); border-radius: 50%; animation: spin 20s linear infinite; opacity: 0.5;"></div>
            <h1 style="font-size: 1.8rem; letter-spacing: -2px; font-weight: 900; text-shadow: 0 0 20px var(--gold);">TERRENCE M</h1>
        </div>
        <div style="margin-top: 30px; background: rgba(0,0,0,0.9); border: 1px solid var(--gold); border-left: 5px solid var(--gold); padding: 15px; font-size: 0.7rem;">
            <p style="color:var(--gold); font-weight: 900;">[ STATUS: GOD_LEVEL ]</p>
            <p style="color:var(--neon); margin: 5px 0;">> SECURITY: TIER_10</p>
            <p style="color:#fff; margin: 5px 0;">> FIREWALL: OMNI_SHIELD</p>
            <div id="telemetry" style="color:rgba(212,175,55,0.5); font-family:monospace; font-size: 0.6rem; margin-top: 10px;"></div>
        </div>
    </div>

    <div style="display: flex; gap: 30px; align-self: center;">
        <div style="text-align: center; background: rgba(10,10,10,0.8); padding: 30px; border: 1px solid var(--gold); box-shadow: inset 0 0 20px rgba(212,175,55,0.1);">
            <span style="display: block; font-size: 3rem; color: var(--gold); font-weight: 900; text-shadow: 0 0 15px var(--gold);">4500+</span>
            <small style="color: #666; letter-spacing: 3px;">CO2_OFFSET</small>
        </div>
        <div style="text-align: center; background: rgba(10,10,10,0.8); padding: 30px; border: 1px solid var(--gold); box-shadow: inset 0 0 20px rgba(212,175,55,0.1);">
            <span style="display: block; font-size: 3rem; color: var(--gold); font-weight: 900; text-shadow: 0 0 15px var(--gold);">1250+</span>
            <small style="color: #666; letter-spacing: 3px;">MW_CLEAN_ENERGY</small>
        </div>
    </div>

    <div style="text-align: right; width: 250px;">
        <div style="border: 2px solid var(--gold); padding: 10px; background: #000; box-shadow: 0 0 50px rgba(0,0,0,1);">
            <div style="width: 100%; height: 180px; border: 2px solid var(--neon); position: relative; overflow: hidden;">
                <video id="webcam" autoplay playsinline muted style="width: 100%; height: 100%; object-fit: cover; filter: sepia(1) hue-rotate(90deg);"></video>
                <div style="position: absolute; top:0; left:0; width:100%; height:2px; background:var(--neon); animation: scanLine 2s infinite linear;"></div>
                <div style="position: absolute; border: 1px solid var(--neon); width: 40px; height: 40px; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.5;"></div>
            </div>
            <p style="color:var(--neon); font-size: 0.6rem; font-weight: 900; margin-top: 10px;">ID: TERRENCE_M [VERIFIED]</p>
        </div>
        <div id="mic-btn" style="margin-top: 20px; background: var(--gold); padding: 15px; border-radius: 5px; cursor: pointer; display: inline-block; transition: 0.3s;" onclick="startListening()">
            <svg viewBox="0 0 24 24" width="30" fill="#000"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
        </div>
    </div>
</div>

<div id="chat-container" style="position: fixed; bottom: 80px; right: 30px; width: 350px; background: rgba(0,0,0,0.95); border: 2px solid var(--gold); z-index: 1000; box-shadow: 0 0 60px #000;">
    <div style="background: var(--gold); color: #000; padding: 12px; font-weight: 900; font-size: 0.7rem; display: flex; justify-content: space-between;">
        <span>CORE_INTEL_SYSTEM_V.5</span>
        <span id="system-clock">00:00:00</span>
    </div>
    <div id="chat-box" style="height: 180px; overflow-y: auto; padding: 15px; font-size: 0.7rem; color: #fff; font-family: 'Courier New', monospace; line-height: 1.5;"></div>
    <div style="display: flex; border-top: 2px solid var(--gold);">
        <input type="text" id="user-input" placeholder="EXECUTE_COMMAND..." style="flex:1; background:#000; border:none; color:#fff; padding:15px; font-family:'Orbitron'; font-size:0.7rem; outline:none;">
        <button onclick="sendMessage()" style="background:var(--gold); border:none; padding:15px 25px; cursor:pointer; font-weight:900;">GO</button>
    </div>
</div>

<style>
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes scanLine { 0% { top: 0; } 100% { top: 100%; } }
    @keyframes pulse { 0% { opacity: 0.2; } 50% { opacity: 1; } 100% { opacity: 0.2; } }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: var(--gold); }
</style>

<script>
    // 1. BOOT SEQUENCE
    const messages = [
        "SISTEMA OPERATIVO INICIADO...",
        "CARGANDO KERNEL TERRENCE_M...",
        "ACTIVANDO FIREWALL NIVEL DIOS...",
        "SINCRONIZANDO SATELITES...",
        "ACCESO BIOMETRICO CONFIRMADO.",
        "BIENVENIDO, DIRECTOR."
    ];
    let mIdx = 0;
    function runBoot() {
        if(mIdx < messages.length){
            document.getElementById('boot-log').innerHTML += `<p style="margin:5px 0">> ${messages[mIdx]}</p>`;
            mIdx++;
            document.getElementById('boot-progress').style.width = (mIdx * 16.6) + "%";
            setTimeout(runBoot, 700);
        } else {
            setTimeout(() => {
                document.getElementById('boot-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    document.getElementById('main-interface').style.opacity = '1';
                    speak("Sistemas operativos. Nivel Dios activado.");
                }, 1000);
            }, 500);
        }
    }
    window.onload = runBoot;

    // 2. NEURAL BACKGROUND (ELIMINA EL BLANCO)
    const canvas = document.getElementById('neural-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    class Particle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * 0.5;
            this.vy = (Math.random() - 0.5) * 0.5;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
        }
    }
    for(let i=0; i<100; i++) particles.push(new Particle());

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "rgba(212,175,55,0.15)";
        ctx.beginPath();
        particles.forEach(p => {
            p.update();
            particles.forEach(p2 => {
                let dist = Math.hypot(p.x - p2.x, p.y - p2.y);
                if (dist < 100) {
                    ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y);
                }
            });
        });
        ctx.stroke();
        requestAnimationFrame(animate);
    }
    animate();

    // 3. IA & SEGURIDAD
    const audio = document.getElementById('bg-music');
    const video = document.getElementById('webcam');
    navigator.mediaDevices.getUserMedia({ video: true }).then(s => { video.srcObject = s; });
    document.body.addEventListener('click', () => { if(audio.paused) audio.play(); }, { once: true });

    function speak(t) {
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'es-ES'; m.rate = 0.9; m.pitch = 0.6;
        window.speechSynthesis.speak(m);
    }

    setInterval(() => {
        document.getElementById('system-clock').innerText = new Date().toLocaleTimeString();
        document.getElementById('telemetry').innerText = `DATA_STREAM: ${Math.random().toString(16).slice(2,10).toUpperCase()} | SIG: ${Math.floor(Math.random()*100)}%`;
    }, 1000);

    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = Recognition ? new Recognition() : null;
    if(rec){
        rec.lang = 'es-ES';
        function startListening() { rec.start(); speak("Escuchando comandos"); }
        rec.onresult = (e) => { document.getElementById('user-input').value = e.results[0][0].transcript; sendMessage(); };
    }

    function sendMessage() {
        const i = document.getElementById('user-input');
        const b = document.getElementById('chat-box');
        if(!i.value) return;
        b.innerHTML += `<p style="color:#888">> ${i.value}</p>`;
        let r = "Comando procesado en el núcleo de seguridad Terrence.m.";
        if(i.value.toLowerCase().includes("hola")) r = "Director, bienvenido al sistema de máxima seguridad. Todos los protocolos están en nivel Dios.";
        setTimeout(() => { b.innerHTML += `<p style="color:var(--gold)">[IA]: ${r}</p>`; b.scrollTop = b.scrollHeight; speak(r); }, 500);
        i.value = "";
    }
</script>
{% endblock %}